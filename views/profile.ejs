<%- include('templates/header', { title: 'My Profile' , loggedIn, username }) %>

  <div class="container my-4">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="bg-white rounded shadow-sm p-4">
          <h2 class="mb-4">My Profile</h2>

          <!-- Success/Error Messages -->
          <% if (success) { %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              <%= success %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <% } %>
              <% if (error) { %>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  <%= error %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <% } %>

                  <!-- Profile Picture Section -->
                  <div class="card mb-4">
                    <div class="card-body text-center">
                      <h5 class="card-title mb-3">Profile Picture</h5>

                      <!-- Current Profile Picture -->
                      <div class="mb-3">
                        <% if (user && user.profile_picture) { %>
                          <img src="<%= user.profile_picture %>" alt="<%= user.username %>" class="rounded-circle mb-3"
                            width="150" height="150" style="object-fit: cover; border: 3px solid #dee2e6;">
                          <% } else { %>
                            <div
                              class="rounded-circle mx-auto mb-3 bg-secondary d-flex align-items-center justify-content-center text-white"
                              style="width: 150px; height: 150px; font-size: 4rem; font-weight: bold; border: 3px solid #dee2e6;">
                              <%= user.username.charAt(0).toUpperCase() %>
                            </div>
                            <% } %>
                      </div>

                      <!-- Upload Form -->
                      <form action="/profile/upload" method="POST" enctype="multipart/form-data">
                        <div class="mb-3">
                          <input type="file" class="form-control" id="profilePic" name="profilePic" accept="image/*"
                            required>
                          <div class="form-text">Choose an image file (max 10MB)</div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                          <i class="bi bi-upload"></i> Upload Picture
                        </button>
                      </form>

                      <!-- Preview area -->
                      <div id="imagePreview" class="mt-3" style="display: none;">
                        <p class="text-muted small">Preview:</p>
                        <img id="previewImg" class="rounded-circle" width="100" height="100"
                          style="object-fit: cover; border: 2px solid #dee2e6;">
                      </div>
                    </div>
                  </div>

                  <!-- User Information -->
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title mb-3">Account Information</h5>
                      <div class="row mb-2">
                        <div class="col-sm-4 text-muted">Username:</div>
                        <div class="col-sm-8"><strong>
                            <%= user.username %>
                          </strong></div>
                      </div>
                      <div class="row mb-2">
                        <div class="col-sm-4 text-muted">Member Since:</div>
                        <div class="col-sm-8">
                          <%= new Date(user.created_at).toLocaleDateString() %>
                        </div>
                      </div>
                    </div>

                  <!-- Back Button -->
                  <div class="mt-4 text-center">
                    <a href="/" class="btn btn-outline-secondary">‚Üê Back to Home</a>
                  </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Image preview functionality
    document.getElementById('profilePic').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (event) {
          document.getElementById('previewImg').src = event.target.result;
          document.getElementById('imagePreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        document.getElementById('imagePreview').style.display = 'none';
      }
    });
  </script>

  <%- include('templates/footer') %>